import{b as F,a as S,t as W,d as oe}from"../chunks/IJMoEVRx.js";import{p as J,s as u,f as M,c as R,n as E,r as T,b as K,a as p,u as B,d as i,g as e,t as $,e as z}from"../chunks/DVmdCokJ.js";import{d as Q,p as o,s as q}from"../chunks/D1rJHNN0.js";import{i as C}from"../chunks/CJVv8vLi.js";import{o as se}from"../chunks/nV-4aG2w.js";import{C as G}from"../chunks/CQecHAK4.js";import{b as U,p as le}from"../chunks/B5Nunh1s.js";import{I as P,p as j}from"../chunks/CDgYgN1L.js";import{D as ae}from"../chunks/CjUBkUV9.js";var ue=W("<div>Incorrect password, please try again.</div>"),de=W('<div>Password</div> <!> <br><br> <button aria-label="login"><!></button> <br><br> <!>',1);function ce(_,t){J(t,!0);let r="",a;const s=()=>{t.backendApi.login(r),a.writeValue("")};var v=de(),d=u(M(v),2);U(P(d,{ariaLabel:"password",parser:l=>{r=l}}),l=>a=l,()=>a);var f=u(d,5);f.__click=s;var w=R(f);G(w,{children:(l,x)=>{E();var b=F("Log in");S(l,b)},$$slots:{default:!0}}),T(f);var h=u(f,5);{var N=l=>{var x=ue();S(l,x)};C(h,l=>{t.data==="incorrect"&&l(N)})}S(_,v),K()}Q(["click"]);const I={key:"",value:-1};function Z(_,t){J(t,!0);let r=le(t,"kv",15),a=p(""),s=p(o([]));B(()=>{const v=Object.keys(t.options);v.sort((f,w)=>{const h=f.toLowerCase(),N=w.toLowerCase();return h===N?f<w?-1:1:h<N?-1:1});const d=[];for(const f of v)d.push([f,f]);i(s,o(d))}),B(()=>{r({key:e(a),value:t.options[e(a)]??-1})}),ae(_,{get ariaLabel(){return t.ariaLabel},get options(){return e(s)},isDefaultWidth:!0,get value(){return e(a)},set value(v){i(a,o(v))}}),K()}var be=W("<br><br> Meal<br> <!><br> <br><br> Container<br> <!><br> <br><br> Serving 1 weight in grams<br> <!> <br><br> Serving 2 weight in grams<br> <!> <br><br> Serving 3 weight in grams<br> <!> <br><br> ",1);function ve(_,t){J(t,!0);let r=p(o(I)),a=p(o(I)),s=p(o(NaN)),v=p(o(NaN)),d=p(o(NaN)),f=p("");const w=(...n)=>{i(r,o(I)),i(a,o(I)),i(s,o(NaN)),i(v,o(NaN)),i(d,o(NaN))};B(()=>w(t.dataStore)),B(()=>{if(e(r).value<0||e(a).value<0){i(f,"");return}let n=0,V=0;for(const O of[e(s),e(v),e(d)])isFinite(O)&&(n++,V+=(O-e(a).value)*e(r).value);if(n<1){i(f,"");return}i(f,o(Math.round(V).toString()))});var h=be(),N=u(M(h),5);Z(N,{ariaLabel:"meal selection",get options(){return t.dataStore.meals},get kv(){return e(r)},set kv(n){i(r,o(n))}});var l=u(N,2),x=u(l,6);Z(x,{ariaLabel:"container selection",get options(){return t.dataStore.containers},get kv(){return e(a)},set kv(n){i(a,o(n))}});var b=u(x,2),c=u(b,6);const k=z(()=>j(n=>{i(s,o(n))}));P(c,{ariaLabel:"weight 1",get parser(){return e(k)}});var g=u(c,7);const y=z(()=>j(n=>{i(v,o(n))}));P(g,{ariaLabel:"weight 2",get parser(){return e(y)}});var L=u(g,7);const D=z(()=>j(n=>{i(d,o(n))}));P(L,{ariaLabel:"weight 3",get parser(){return e(D)}});var A=u(L,4);$(()=>{q(l,` Calorie Density (KCal/g): ${(e(r).value<0?"":e(r).value)??""} `),q(b,` Container Weight (g): ${(e(a).value<0?"":e(a).value)??""} `),q(A,` Calories: ${e(f)??""}`)}),S(_,h),K()}var fe=W("<br><br> Weight without peanut butter (in grams, including bowl)<br> <!> <br><br> Weight with peanut butter (in grams, including bowl)<br> <!> <br><br> <br> *Assumes 1/2 cup of quick-cook oats",1);function ge(_,t){J(t,!0);let r=p(o(NaN)),a=p(o(NaN)),s=p("");B(()=>{if(!isFinite(e(r))||!isFinite(e(a))){i(s,"");return}i(s,o((150+(e(a)-e(r))*5.6).toString()))});var v=fe(),d=u(M(v),5);const f=z(()=>j(l=>{i(r,o(l))}));P(d,{ariaLabel:"weight without peanut butter",get parser(){return e(f)}});var w=u(d,7);const h=z(()=>j(l=>{i(a,o(l))}));P(w,{ariaLabel:"weight with peanut butter",get parser(){return e(h)}});var N=u(w,4);E(2),$(()=>q(N,` Calories: ${e(s)??""} `)),S(_,v),K()}const ne=_=>t=>{const r={...t[_.datakey]};r[_.name]=_.value;const a={...t};return a[_.datakey]=r,a},_e=_=>t=>{const r={...t[_.datakey]};delete r[_.name];const a={...t};return a[_.datakey]=r,a},ke=(_,t,r,a)=>{e(t).length===0||!isFinite(e(r))||e(r)<0||a.backendApi.write(ne({datakey:"meals",name:e(t),value:e(r)}))};var me=W('<br><br> Name<br> <!> <br><br> Calories<br> <!> <br><br> Weight 1 (lbs)<br> <!> <br><br> Weight 2 (lbs)<br> <!> <br><br> Container<br> <!> <br><br> <br><br> <button aria-label="save"><!></button>',1);function we(_,t){J(t,!0);let r,a,s,v;const d=(...m)=>{r.writeValue(""),a.writeValue(""),s.writeValue(""),v.writeValue("")};B(()=>d(t.dataStore));let f=p(""),w=p(o(NaN)),h=p(o(NaN)),N=p(o(NaN)),l=p(o(I)),x=p(o(NaN));B(()=>{if(!isFinite(e(w))||!isFinite(e(h))||!isFinite(e(N))||e(l).value<0){i(x,o(NaN));return}const Y=Math.abs(e(h)-e(N))*453.592-e(l).value;i(x,e(w)/Y)});var b=me(),c=u(M(b),5);U(P(c,{ariaLabel:"entry name",parser:m=>{i(f,o(m))}}),m=>r=m,()=>r);var k=u(c,7);const g=z(()=>j(m=>{i(w,o(m))}));U(P(k,{ariaLabel:"meal calories",get parser(){return e(g)}}),m=>a=m,()=>a);var y=u(k,7);const L=z(()=>j(m=>{i(h,o(m))}));U(P(y,{ariaLabel:"weight 1 (lbs)",get parser(){return e(L)}}),m=>s=m,()=>s);var D=u(y,7);const A=z(()=>j(m=>{i(N,o(m))}));U(P(D,{ariaLabel:"weight 2 (lbs)",get parser(){return e(A)}}),m=>v=m,()=>v);var n=u(D,7);Z(n,{ariaLabel:"container",get options(){return t.dataStore.containers},get kv(){return e(l)},set kv(m){i(l,o(m))}});var V=u(n,4),O=u(V,4);O.__click=[ke,f,x,t];var X=R(O);G(X,{children:(m,Y)=>{E();var H=F("Save");S(m,H)},$$slots:{default:!0}}),T(O),$(m=>q(V,` Calorie Density (KCal/g): ${m??""} `),[()=>isFinite(e(x))?e(x):""]),S(_,b),K()}Q(["click"]);const he=(_,t,r,a,s)=>{e(t).length===0||!isFinite(e(r))||(a.backendApi.write(ne({datakey:a.datakey,name:e(t),value:e(r)})),s())};var ye=W('<br><br> Name<br> <!> <br><br> <!><br> <!> <br><br> <button aria-label="save"><!></button>',1);function te(_,t){J(t,!0);let r,a,s=p(""),v=p(o(NaN));const d=(...g)=>{i(s,""),i(v,o(NaN)),r.writeValue(""),a.writeValue("")};B(()=>d(t.datakey));var f=ye(),w=u(M(f),5);U(P(w,{ariaLabel:"entry name",parser:g=>{i(s,o(g))}}),g=>r=g,()=>r);var h=u(w,5);{var N=g=>{var y=F("Calorie Density (KCal/g)");S(g,y)},l=g=>{var y=F("Container Weight (g)");S(g,y)};C(h,g=>{t.datakey==="meals"?g(N):g(l,!1)})}var x=u(h,3);const b=z(()=>j(g=>{i(v,o(g))}));U(P(x,{ariaLabel:"entry value",get parser(){return e(b)}}),g=>a=g,()=>a);var c=u(x,5);c.__click=[he,s,v,t,d];var k=R(c);G(k,{children:(g,y)=>{E();var L=F("Save");S(g,L)},$$slots:{default:!0}}),T(c),S(_,f),K()}Q(["click"]);const pe=(_,t,r)=>{e(t).key.length===0||e(t).value<0||r.backendApi.write(_e({datakey:r.datakey,name:e(t).key}))};var Se=W('<br><br> <!><br> <!> <br><br> <button aria-label="DELETE"><!></button>',1);function re(_,t){J(t,!0);let r=p(o(I));const a=(...l)=>{i(r,o(I))};B(()=>a(t.dataStore,t.datakey));var s=Se(),v=u(M(s),3);{var d=l=>{var x=F("Meal");S(l,x)},f=l=>{var x=F("Container");S(l,x)};C(v,l=>{t.datakey==="meals"?l(d):l(f,!1)})}var w=u(v,3);Z(w,{ariaLabel:"selection",get options(){return t.dataStore[t.datakey]},get kv(){return e(r)},set kv(l){i(r,o(l))}});var h=u(w,5);h.__click=[pe,r,t];var N=R(h);G(N,{children:(l,x)=>{E();var b=F("DELETE");S(l,b)},$$slots:{default:!0}}),T(h),S(_,s),K()}Q(["click"]);var xe=(_,t)=>{t.backendApi.read(!1)},Ne=(_,t)=>{t.backendApi.logout()},Ae=W('<br><br> <button aria-label="sync"><!></button> <br><br> <button aria-label="login"><!></button>',1),Le=W("Mode<br> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1);function Ce(_,t){J(t,!0);let r=p("serve");E();var a=Le(),s=u(M(a),3);ae(s,{ariaLabel:"select mode",options:[["serve","Serve"],["oat-wizard","Oat Wizard"],["add-meal-wizard","Add Meal (Wizard)"],["add-meal-manual","Add Meal (Manual)"],["add-container","Add Container"],["del-meal","Delete Meal"],["del-container","Delete Container"],["admin","Admin"]],isDefaultWidth:!0,get value(){return e(r)},set value(n){i(r,o(n))}});var v=u(s,2);{var d=n=>{ve(n,{get dataStore(){return t.dataStore}})};C(v,n=>{e(r)==="serve"&&n(d)})}var f=u(v,2);{var w=n=>{ge(n,{})};C(f,n=>{e(r)==="oat-wizard"&&n(w)})}var h=u(f,2);{var N=n=>{we(n,{get dataStore(){return t.dataStore},get backendApi(){return t.backendApi}})};C(h,n=>{e(r)==="add-meal-wizard"&&n(N)})}var l=u(h,2);{var x=n=>{te(n,{get backendApi(){return t.backendApi},datakey:"meals"})};C(l,n=>{e(r)==="add-meal-manual"&&n(x)})}var b=u(l,2);{var c=n=>{te(n,{get backendApi(){return t.backendApi},datakey:"containers"})};C(b,n=>{e(r)==="add-container"&&n(c)})}var k=u(b,2);{var g=n=>{re(n,{get dataStore(){return t.dataStore},get backendApi(){return t.backendApi},datakey:"meals"})};C(k,n=>{e(r)==="del-meal"&&n(g)})}var y=u(k,2);{var L=n=>{re(n,{get dataStore(){return t.dataStore},get backendApi(){return t.backendApi},datakey:"containers"})};C(y,n=>{e(r)==="del-container"&&n(L)})}var D=u(y,2);{var A=n=>{var V=Ae(),O=u(M(V),3);O.__click=[xe,t];var X=R(O);G(X,{children:(H,ie)=>{E();var ee=F("Sync");S(H,ee)},$$slots:{default:!0}}),T(O);var m=u(O,5);m.__click=[Ne,t];var Y=R(m);G(Y,{children:(H,ie)=>{E();var ee=F("Log out");S(H,ee)},$$slots:{default:!0}}),T(m),S(n,V)};C(D,n=>{e(r)==="admin"&&n(A)})}S(_,a),K()}Q(["click"]);var De=W('<div class="viewport-center text-center w-fit svelte-1f5hzp9"><!></div>'),Oe=W("<!> <!>",1),Pe=W(" <br><br>Please re-load the page.",1);function Ke(_,t){J(t,!0);let r=p("ok"),a=p(!1),s=p("missing");const v=()=>{i(r,"network-error"),i(s,"missing")},d=()=>{i(r,"server-error"),i(s,"missing")},f=async b=>{let c;try{c=await fetch(new TextDecoder().decode(new Uint8Array([104,116,116,112,115,58,47,47,119,101,98,45,97,112,105,46,97,97,114,111,110,115,116,97,110,101,107,46,99,111,109,47,113,117,105,99,107,45,99,97,108,111,114,105,101])),{method:"POST",credentials:"include",body:JSON.stringify(b)})}catch{return{headline:"error"}}if(c.status<200||c.status>299)return{headline:"status",status:c.status};try{return{headline:"ok",body:await c.text()}}catch{return{headline:"error"}}},w={login:async b=>{if(e(r)!=="ok"||e(a))return;i(a,!0);const c=await f({method:"login",password:b});if(c.headline==="error")return v();if(c.headline==="status")return d();let k;try{k=JSON.parse(c.body)}catch{return d()}if(typeof k!="object"||k===null||typeof k.ok!="boolean")return d();k.ok?await w.read(!0):i(s,"incorrect"),i(a,!1)},logout:async()=>{if(e(r)!=="ok"||e(a))return;i(a,!0);const b=await f({method:"logout"});if(b.headline==="error")return v();if(b.headline==="status")return d();i(s,"missing"),i(a,!1)},read:async b=>{if(e(r)!=="ok")return;if(!b){if(e(a))return;i(a,!0)}const c=await f({method:"read"});if(c.headline==="error")return v();if(c.headline==="status"){if(c.status===403){i(s,"missing"),b||i(a,!1);return}return d()}let k;try{k=JSON.parse(c.body)}catch{return d()}let g;try{g=BigInt(k.k)}catch{return d()}let y;try{y=JSON.parse(k.v)}catch{return d()}if(typeof y!="object"||y===null)return d();for(const L of["meals","containers"]){const D=y[L];if(typeof D!="object"||D===null)return d();for(const A of Object.keys(D))if(typeof D[A]!="number")return d()}i(s,o({k:g,v:y})),b||i(a,!1)},write:async b=>{if(e(r)!=="ok"||e(a))return;i(a,!0);let c=0;for(;;){if(e(r)!=="ok"||typeof e(s)=="string"){i(a,!1);return}if(c>=5)return d();const k=e(s).k+1n,g=b(e(s).v),y=await f({method:"write",oldVersion:e(s).k.toString(),newVersion:k.toString(),payload:JSON.stringify(g)});if(y.headline==="error")return v();if(y.headline==="status"){if(y.status===403){i(s,"missing"),i(a,!1);return}return d()}if(y.body==="1"){i(s,o({k,v:g}));break}if(y.body==="0"){await w.read(!0),c++;continue}return d()}i(a,!1)}};se(()=>w.read(!1));var h=oe(),N=M(h);{var l=b=>{var c=Oe(),k=M(c);{var g=A=>{var n=De(),V=R(n);G(V,{children:(O,X)=>{E();var m=F("working...");S(O,m)},$$slots:{default:!0}}),T(n),S(A,n)};C(k,A=>{e(a)&&A(g)})}var y=u(k,2);{var L=A=>{ce(A,{get data(){return e(s)},backendApi:w})},D=A=>{Ce(A,{get dataStore(){return e(s).v},backendApi:w})};C(y,A=>{typeof e(s)=="string"?A(L):A(D,!1)})}S(b,c)},x=b=>{var c=Pe(),k=M(c,!0);E(3),$(()=>q(k,e(r))),S(b,c)};C(N,b=>{e(r)==="ok"?b(l):b(x,!1)})}S(_,h),K()}export{Ke as component};
